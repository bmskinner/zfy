# Find NLS based on NLStradamus

# install.packages('HMM')
library(HMM)


# $e{0}{"L"} = 0.0950300339227636;
# $e{0}{"S"} = 0.0898291379118776;
# $e{0}{"K"} = 0.0734833177642526;
# $e{0}{"I"} = 0.0655547462377008;
# $e{0}{"E"} = 0.0654254611397116;
# $e{0}{"N"} = 0.0616309263671642;
# $e{0}{"T"} = 0.0591563341467664;
# $e{0}{"D"} = 0.0585263693589517;
# $e{0}{"V"} = 0.0556015083490053;
# $e{0}{"A"} = 0.0549499388896433;
# $e{0}{"G"} = 0.0497648177182998;
# $e{0}{"R"} = 0.0443626210376004;
# $e{0}{"F"} = 0.0441551476044877;
# $e{0}{"P"} = 0.0437563185090993;
# $e{0}{"Q"} = 0.0395581536030419;
# $e{0}{"Y"} = 0.0337842193992118;
# $e{0}{"H"} = 0.0216513102033034;
# $e{0}{"M"} = 0.0208056416313105;
# $e{0}{"C"} = 0.0125821491915738;
# $e{0}{"W"} = 0.0103918470142344;
# 
# $e{0}{"B"} = $e{0}{"D"} + $e{0}{"N"};
# $e{0}{"X"} = 1;
# $e{0}{"Z"} = $e{0}{"E"} + $e{0}{"Q"};

# 
# $e{1}{'L'} = 0.0548387096774;
# $e{1}{'S'} = 0.0677419354839;
# $e{1}{'K'} = 0.270967741935;
# $e{1}{'I'} = 0.041935483871;
# $e{1}{'E'} = 0.041935483871;
# $e{1}{'N'} = 0.041935483871;
# $e{1}{'T'} = 0.0306451612903;
# $e{1}{'D'} = 0.0258064516129;
# $e{1}{'V'} = 0.0290322580645;
# $e{1}{'A'} = 0.0516129032258;
# $e{1}{'G'} = 0.0564516129032;
# $e{1}{'R'} = 0.133870967742;
# $e{1}{'F'} = 0.0209677419355;
# $e{1}{'P'} = 0.0564516129032;
# $e{1}{'Q'} = 0.0225806451613;
# $e{1}{'Y'} = 0.0112903225806;
# $e{1}{'H'} = 0.0225806451613;
# $e{1}{'M'} = 0.0112903225806;
# $e{1}{'C'} = 0.00161290322581;
# $e{1}{'W'} = 0.00645161290323;

# $e{1}{"B"} = $e{1}{"D"} + $e{1}{"N"};
# $e{1}{"X"} = 1;
# $e{1}{"Z"} = $e{1}{"E"} + $e{1}{"Q"};

states <- c("0", "1")
symbols <- c("L", "S", "K", "I", "E", "N", "T", "D", "V", "A", "G", "R", "F", "P", "Q", "Y", "H", "M", "C", "W", "B", "X", "Z")

trans.probs <- matrix(c(0.00263746344819678, 1-0.00263746344819678, 
                        0.0741935483870968, 1-0.0741935483870968), 2, byrow = T)
start.probs <- c(trans.probs[1,1], 1-trans.probs[1,1])

emm.probs <- matrix(c(0.0950300339227636, 0.0898291379118776, 0.0734833177642526, 0.0655547462377008, 0.0654254611397116, 0.0616309263671642, 
                      0.0591563341467664, 0.0585263693589517, 0.0556015083490053, 0.0549499388896433, 0.0497648177182998, 0.0443626210376004, 
                      0.0441551476044877, 0.0437563185090993, 0.0395581536030419, 0.0337842193992118, 0.0216513102033034, 0.0208056416313105, 
                      0.0125821491915738, 0.0103918470142344, (0.0585263693589517 + 0.0616309263671642), 1, (0.0654254611397116+0.0395581536030419),
                    
                      0.0548387096774, 0.0677419354839, 0.270967741935, 0.041935483871, 0.041935483871, 0.041935483871, 0.0306451612903, 
                      0.0258064516129, 0.0290322580645, 0.0516129032258, 0.0564516129032, 0.133870967742, 0.0209677419355, 0.0564516129032,
                      0.0225806451613, 0.0112903225806, 0.0225806451613, 0.0112903225806, 0.00161290322581, 0.00645161290323, 
                      (0.0258064516129+0.041935483871), 1, (0.041935483871+0.0225806451613))
                    
                    , 2, byrow = T)

hmm <- HMM::initHMM(states,symbols , start.probs, trans.probs, emm.probs)

test.seq <- as.character(combined.aa.raw$Cattle_ZFX)[-801] # remove stop

HMM::viterbi(hmm, test.seq) 

HMM::simHMM(hmm,100)

HMM::forward(hmm, test.seq)

HMM::backward(hmm, test.seq)

plot(HMM::posterior(hmm, test.seq)[2,])


# ## Transition Frequencies
# ($a[0][1]) = 0.00263746344819678;
# ($a[0][0]) = 1-$a[0][1];
# 
# ($a[1][0]) = 0.0741935483870968;
# ($a[1][1]) = 1 - $a[1][0];
# 
# ($begin[0]) = $a[0][0];
# ($begin[1]) = 1 - $begin[0];


